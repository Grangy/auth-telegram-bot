<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Authorization</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .logo {
            width: 80px;
            height: 80px;
            background: #0088cc;
            border-radius: 50%;
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
        }

        h1 {
            color: #333;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .phone-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 1rem;
            transition: border-color 0.3s;
        }

        .phone-input:focus {
            outline: none;
            border-color: #0088cc;
        }

        .auth-btn {
            background: #0088cc;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
            width: 100%;
            margin-bottom: 1rem;
        }

        .auth-btn:hover {
            background: #006699;
        }

        .auth-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s;
            width: 100%;
        }

        .logout-btn:hover {
            background: #c82333;
        }

        .reset-btn {
            background: #ffc107;
            color: #212529;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s;
            width: 100%;
            margin-bottom: 10px;
        }

        .reset-btn:hover {
            background: #e0a800;
        }

        .back-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s;
            width: 100%;
            margin-top: 10px;
        }

        .back-btn:hover {
            background: #5a6268;
        }

        .status {
            margin-top: 1rem;
            padding: 10px;
            border-radius: 8px;
            font-weight: 500;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .hidden {
            display: none;
        }

        .user-info {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .user-info h3 {
            color: #333;
            margin-bottom: 0.5rem;
        }

        .user-info p {
            color: #666;
            margin-bottom: 0.25rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">üì±</div>
        <h1>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram</h1>
        
        <div id="authForm">
            <input type="tel" id="phoneInput" class="phone-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞" maxlength="15">
            <button id="authBtn" class="auth-btn">–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ Telegram</button>
        </div>

        <div id="codeForm" class="hidden">
            <input type="text" id="codeInput" class="phone-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ Telegram" maxlength="4">
            <button id="verifyBtn" class="auth-btn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∫–æ–¥</button>
            <button id="backBtn" class="back-btn">‚Üê –ù–∞–∑–∞–¥ –∫ –Ω–æ–º–µ—Ä—É</button>
        </div>

        <div id="userInfo" class="user-info hidden">
            <h3>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h3>
            <p id="userPhone"></p>
            <p id="userName"></p>
            <button id="resetSessionBtn" class="reset-btn">–°–±—Ä–æ—Å —Å–µ—Å—Å–∏–∏</button>
            <button id="logoutBtn" class="logout-btn">–í—ã–π—Ç–∏</button>
        </div>

        <div id="status" class="status hidden"></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const authForm = document.getElementById('authForm');
        const codeForm = document.getElementById('codeForm');
        const userInfo = document.getElementById('userInfo');
        const phoneInput = document.getElementById('phoneInput');
        const codeInput = document.getElementById('codeInput');
        const authBtn = document.getElementById('authBtn');
        const verifyBtn = document.getElementById('verifyBtn');
        const backBtn = document.getElementById('backBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const resetSessionBtn = document.getElementById('resetSessionBtn');
        const status = document.getElementById('status');
        const userPhone = document.getElementById('userPhone');
        const userName = document.getElementById('userName');

        let authKey = null;
        let currentPhone = null;
        let isWaitingForCode = false;
        let sessionToken = null;

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–∑ localStorage
        function loadState() {
            const savedPhone = localStorage.getItem('authPhone');
            const savedState = localStorage.getItem('authState');
            const savedSessionToken = localStorage.getItem('sessionToken');
            
            if (savedSessionToken) {
                sessionToken = savedSessionToken;
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—É—é —Å–µ—Å—Å–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
                socket.emit('checkAuth', { sessionToken: savedSessionToken });
                return;
            }
            
            if (savedPhone && savedState) {
                currentPhone = savedPhone;
                phoneInput.value = savedPhone;
                
                if (savedState === 'waitingForCode') {
                    isWaitingForCode = true;
                    showCodeForm();
                }
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ localStorage
        function saveState(phone, state) {
            if (phone) {
                localStorage.setItem('authPhone', phone);
                currentPhone = phone;
            }
            localStorage.setItem('authState', state);
        }

        // –û—á–∏—Å—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        function clearState() {
            localStorage.removeItem('authPhone');
            localStorage.removeItem('authState');
            localStorage.removeItem('sessionToken');
            currentPhone = null;
            isWaitingForCode = false;
            sessionToken = null;
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–π —Å–µ—Å—Å–∏–∏
        function saveLongTermSession(token) {
            localStorage.setItem('sessionToken', token);
            sessionToken = token;
        }

        // –ü—Ä–æ–¥–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
        function extendSession() {
            if (sessionToken) {
                socket.emit('extendSession', { sessionToken: sessionToken });
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –≤–≤–æ–¥–∞ –∫–æ–¥–∞
        function showCodeForm() {
            authForm.classList.add('hidden');
            codeForm.classList.remove('hidden');
            codeInput.focus();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function showAuthForm() {
            authForm.classList.remove('hidden');
            codeForm.classList.add('hidden');
            phoneInput.focus();
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadState();

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        phoneInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.startsWith('7')) {
                value = '+' + value;
            } else if (value.startsWith('8')) {
                value = '+7' + value.substring(1);
            } else if (value && !value.startsWith('+')) {
                value = '+' + value;
            }
            e.target.value = value;
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        socket.on('connect', () => {
            socket.emit('checkAuth');
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        authBtn.addEventListener('click', () => {
            const phone = phoneInput.value.trim();
            if (!phone) {
                showStatus('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞', 'error');
                return;
            }

            if (!phone.match(/^\+[1-9]\d{1,14}$/)) {
                showStatus('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞', 'error');
                return;
            }

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–º–µ—Ä –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            saveState(phone, 'requesting');
            
            authBtn.disabled = true;
            authBtn.textContent = '–û–∂–∏–¥–∞–Ω–∏–µ...';
            showStatus('–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é...', 'info');

            socket.emit('requestAuth', { phone });
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã—Ö–æ–¥–∞
        logoutBtn.addEventListener('click', () => {
            socket.emit('logout');
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–±—Ä–æ—Å–∞ —Å–µ—Å—Å–∏–∏
        resetSessionBtn.addEventListener('click', () => {
            socket.emit('resetSession');
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∫–æ–¥–∞
        verifyBtn.addEventListener('click', () => {
            const code = codeInput.value.trim();
            if (!code) {
                showStatus('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥', 'error');
                return;
            }

            if (!code.match(/^\d{4}$/)) {
                showStatus('–ö–æ–¥ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 4 —Ü–∏—Ñ—Ä—ã', 'error');
                return;
            }

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            saveState(null, 'verifying');
            
            verifyBtn.disabled = true;
            verifyBtn.textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞...';
            showStatus('–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞...', 'info');

            socket.emit('verifyCode', { code });
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –≤ –ø–æ–ª–µ –∫–æ–¥–∞
        codeInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                verifyBtn.click();
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
        backBtn.addEventListener('click', () => {
            showAuthForm();
            clearState();
            showStatus('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏', 'info');
        });

        // Socket —Å–æ–±—ã—Ç–∏—è
        socket.on('authKey', (data) => {
            authKey = data.key;
            const link = data.link;
            const qrCode = data.qrCode;
            
            if (qrCode) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º QR-–∫–æ–¥
                showStatus(`–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ Telegram:`, 'info');
                
                // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è QR-–∫–æ–¥–∞
                const qrContainer = document.createElement('div');
                qrContainer.style.cssText = `
                    text-align: center;
                    margin-top: 20px;
                    padding: 20px;
                    background: white;
                    border-radius: 15px;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
                `;
                
                // –°–æ–∑–¥–∞–µ–º QR-–∫–æ–¥ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                const qrImage = document.createElement('img');
                qrImage.src = qrCode;
                qrImage.style.cssText = `
                    max-width: 250px;
                    height: auto;
                    border-radius: 10px;
                    margin-bottom: 15px;
                `;
                
                // –°–æ–∑–¥–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
                const instruction = document.createElement('p');
                instruction.textContent = '–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –∫–∞–º–µ—Ä–æ–π —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫—É –Ω–∏–∂–µ';
                instruction.style.cssText = `
                    color: #666;
                    font-size: 14px;
                    margin-bottom: 15px;
                `;
                
                // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É-—Å—Å—ã–ª–∫—É
                const linkButton = document.createElement('a');
                linkButton.href = link;
                linkButton.target = '_blank';
                linkButton.textContent = 'üîó –û—Ç–∫—Ä—ã—Ç—å –≤ Telegram';
                linkButton.style.cssText = `
                    display: inline-block;
                    background: #0088cc;
                    color: white;
                    padding: 12px 24px;
                    border-radius: 8px;
                    text-decoration: none;
                    font-weight: bold;
                    transition: background 0.3s;
                `;
                
                linkButton.addEventListener('mouseenter', () => {
                    linkButton.style.background = '#006699';
                });
                
                linkButton.addEventListener('mouseleave', () => {
                    linkButton.style.background = '#0088cc';
                });
                
                // –°–æ–±–∏—Ä–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                qrContainer.appendChild(qrImage);
                qrContainer.appendChild(instruction);
                qrContainer.appendChild(linkButton);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ—Å–ª–µ —Å—Ç–∞—Ç—É—Å–∞
                status.parentNode.insertBefore(qrContainer, status.nextSibling);
            } else {
                // Fallback - —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∞
                showStatus(`–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫—É –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ Telegram:`, 'info');
                
                const linkButton = document.createElement('a');
                linkButton.href = link;
                linkButton.target = '_blank';
                linkButton.textContent = 'üîó –û—Ç–∫—Ä—ã—Ç—å –≤ Telegram';
                linkButton.style.cssText = `
                    display: inline-block;
                    background: #0088cc;
                    color: white;
                    padding: 12px 24px;
                    border-radius: 8px;
                    text-decoration: none;
                    margin-top: 10px;
                    font-weight: bold;
                `;
                
                status.parentNode.insertBefore(linkButton, status.nextSibling);
            }
        });

        socket.on('authSuccess', (data) => {
            showStatus('–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!', 'success');
            userPhone.textContent = `–¢–µ–ª–µ—Ñ–æ–Ω: ${data.phone}`;
            userName.textContent = `–ò–º—è: ${data.name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}`;
            authForm.classList.add('hidden');
            codeForm.classList.add('hidden');
            userInfo.classList.remove('hidden');
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—É—é —Å–µ—Å—Å–∏—é
            if (data.sessionToken) {
                saveLongTermSession(data.sessionToken);
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤
                setInterval(extendSession, 12 * 60 * 60 * 1000);
            }
            
            // –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            localStorage.removeItem('authPhone');
            localStorage.removeItem('authState');
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏
            authBtn.disabled = false;
            authBtn.textContent = '–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ Telegram';
            verifyBtn.disabled = false;
            verifyBtn.textContent = '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∫–æ–¥';
            codeInput.value = '';
        });

        socket.on('authError', (message) => {
            showStatus(message, 'error');
            authBtn.disabled = false;
            authBtn.textContent = '–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ Telegram';
            verifyBtn.disabled = false;
            verifyBtn.textContent = '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∫–æ–¥';
            
            // –ü—Ä–∏ –æ—à–∏–±–∫–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ —Ñ–æ—Ä–º–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            if (isWaitingForCode) {
                showAuthForm();
                clearState();
            }
        });

        socket.on('logoutSuccess', () => {
            showStatus('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'info');
            authForm.classList.remove('hidden');
            userInfo.classList.add('hidden');
            phoneInput.value = '';
            authBtn.disabled = false;
            authBtn.textContent = '–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ Telegram';
            
            // –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ
            clearState();
        });

        socket.on('alreadyAuthorized', (data) => {
            userPhone.textContent = `–¢–µ–ª–µ—Ñ–æ–Ω: ${data.phone}`;
            userName.textContent = `–ò–º—è: ${data.name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}`;
            authForm.classList.add('hidden');
            codeForm.classList.add('hidden');
            userInfo.classList.remove('hidden');
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω —Å–µ—Å—Å–∏–∏ –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
            if (data.sessionToken) {
                saveLongTermSession(data.sessionToken);
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤
                setInterval(extendSession, 12 * 60 * 60 * 1000);
            }
        });

        socket.on('sessionReset', () => {
            showStatus('–°–µ—Å—Å–∏—è —Å–±—Ä–æ—à–µ–Ω–∞. –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.', 'info');
            authForm.classList.remove('hidden');
            codeForm.classList.add('hidden');
            userInfo.classList.add('hidden');
            phoneInput.value = '';
            codeInput.value = '';
            authBtn.disabled = false;
            authBtn.textContent = '–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ Telegram';
            verifyBtn.disabled = false;
            verifyBtn.textContent = '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∫–æ–¥';
            
            // –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ —Å–±—Ä–æ—Å–µ —Å–µ—Å—Å–∏–∏
            clearState();
        });

        socket.on('smsCodeSent', (data) => {
            showStatus(`–ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram –Ω–∞ –Ω–æ–º–µ—Ä ${data.phone}. –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –Ω–∏–∂–µ:`, 'info');
            saveState(data.phone, 'waitingForCode');
            showCodeForm();
        });

        socket.on('sessionExtended', (data) => {
            if (data.success) {
                console.log('–°–µ—Å—Å–∏—è —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–¥–ª–µ–Ω–∞');
            } else {
                console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–¥–ª–∏—Ç—å —Å–µ—Å—Å–∏—é');
                // –ü—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–º –ø—Ä–æ–¥–ª–µ–Ω–∏–∏ –æ—á–∏—â–∞–µ–º —Å–µ—Å—Å–∏—é
                clearState();
                showAuthForm();
                showStatus('–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –∑–∞–Ω–æ–≤–æ.', 'info');
            }
        });

        function showStatus(message, type) {
            status.textContent = message;
            status.className = `status ${type}`;
            status.classList.remove('hidden');
            
            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    status.classList.add('hidden');
                }, 5000);
            }
        }
    </script>
</body>
</html>
